<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>بطاقة الطالب - المدرسة العربية</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #f8fafc 0%, #d1e7fd 100%);
            min-height: 100vh;
            overflow-x: hidden;
            transition: background 1.2s cubic-bezier(.68,-0.55,.27,1.55);
        }
        body.level-none-bg {
            background: linear-gradient(135deg, #f8fafc 0%, #e0e0e0 100%);
        }
        body.level-beginner-bg {
            background: linear-gradient(135deg, #fffde7 0%, #ffe082 100%);
        }
        body.level-intermediate-bg {
            background: linear-gradient(135deg, #e3f2fd 0%, #81d4fa 100%);
        }
        body.level-advanced-bg {
            background: linear-gradient(135deg, #e8f5e9 0%, #a5d6a7 100%);
        }
        body.level-master-bg {
            background: radial-gradient(circle at 70% 20%, #fffbe7 0%, #ffd700 40%, #e53935 100%);
            animation: masteryShine 3s linear infinite;
        }
        @keyframes masteryShine {
            0% { filter: brightness(1) drop-shadow(0 0 0px #ffd700); }
            50% { filter: brightness(1.12) drop-shadow(0 0 32px #ffd70088); }
            100% { filter: brightness(1) drop-shadow(0 0 0px #ffd700); }
        }
        .mastery-firework {
            position: fixed;
            pointer-events: none;
            left: 0; top: 0; width: 100vw; height: 100vh;
            z-index: 1000;
            animation: fadeOut 2.5s forwards;
        }
        @keyframes fadeOut { 0% { opacity: 1; } 90% { opacity: 1; } 100% { opacity: 0; } }
        .bg-shape { position: absolute; border-radius: 50%; opacity: 0.18; z-index: 0; animation: float 8s ease-in-out infinite; }
        .bg-shape1 { width: 160px; height: 160px; background: #ffd700; top: 5%; left: 10%; animation-delay: 0s; }
        .bg-shape2 { width: 120px; height: 120px; background: #81d4fa; bottom: 10%; right: 12%; animation-delay: 2s; }
        .bg-shape3 { width: 90px; height: 90px; background: #a5d6a7; top: 60%; left: 70%; animation-delay: 4s; }
        .star { position: absolute; width: 20px; height: 20px; background: url('https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/2b50.png') no-repeat center/contain; opacity: 0.6; animation: starFloat 8s linear infinite; z-index: 1; }
        .star1 { top: 20%; left: 80%; animation-delay: 0s; }
        .star2 { top: 70%; left: 30%; animation-delay: 2s; }
        .star3 { top: 50%; left: 60%; animation-delay: 4s; }
        @keyframes starFloat { 0% { transform: translateY(0) scale(1); opacity: 0.6; } 50% { transform: translateY(-30px) scale(1.2); opacity: 1; } 100% { transform: translateY(0) scale(1); opacity: 0.6; } }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-30px); } }
        .student-card { border-radius: 2rem; box-shadow: 0 12px 32px rgba(0,0,0,0.18); background: rgba(255,255,255,0.95); padding: 2rem 2.5rem; margin: 2rem auto; max-width: 900px; position: relative; z-index: 2; animation: cardFadeIn 1.2s cubic-bezier(.68,-0.55,.27,1.55); }
        @keyframes cardFadeIn { 0% { opacity: 0; transform: scale(0.92) translateY(60px); } 100% { opacity: 1; transform: scale(1) translateY(0); } }
        .category-header { background: #fffbe7; color: #b8860b; font-weight: bold; font-size: 1.15rem; text-align: center; letter-spacing: 1px; border-top: 2px solid #ffd700; border-bottom: 2px solid #ffd700; }
        .badge-levels { display: flex; gap: 0.4rem; justify-content: center; align-items: center; }
        .badge-icon { font-size: 2.2rem; width: 48px; height: 48px; display: flex; align-items: center; justify-content: center; border-radius: 50%; margin: 0 2px; box-shadow: 0 0 8px 0 rgba(0,0,0,0.08); border: 2px solid #fff; transition: box-shadow 0.3s, transform 0.3s, filter 0.3s, background 0.3s; position: relative; opacity: 0.55; filter: grayscale(0.7); cursor: pointer; background: #f3f3f3; }
        .badge-icon.selected { opacity: 1; filter: none; background: #fffbe7; box-shadow: 0 0 18px 2px #ffd70055; border: 2px solid #ffd700; z-index: 2; transform: scale(1.16); }
        .badge-icon.selected.level-master { background: #ffd700; color: #b8860b; border: 2px solid #e53935; box-shadow: 0 0 24px 4px #e53935cc; }
        .badge-icon.selected.level-advanced { background: #a5d6a7; color: #1b5e20; border: 2px solid #1b5e20; }
        .badge-icon.selected.level-intermediate { background: #81d4fa; color: #01579b; border: 2px solid #01579b; }
        .badge-icon.selected.level-beginner { background: #ffe082; color: #a67c00; border: 2px solid #a67c00; }
        .badge-icon.selected.level-none { background: #e0e0e0; color: #888; border: 2px solid #888; }
        .badge-icon:hover { opacity: 1; filter: none; box-shadow: 0 0 28px 4px #ffd70088; transform: scale(1.18) rotate(-4deg); z-index: 3; }
        .badge-icon.selected.badge-level-up { animation: badgeLevelUp 0.7s cubic-bezier(.68,-0.55,.27,1.55); }
        @keyframes badgeLevelUp { 0% { transform: scale(1.3) rotate(-10deg); filter: brightness(1.6); } 60% { transform: scale(1.5) rotate(10deg); filter: brightness(2); } 100% { transform: scale(1.16) rotate(0); filter: none; } }
        .curriculum-table th, .curriculum-table td { text-align: center; vertical-align: middle; }
        .curriculum-table th { background: #e3f2fd; color: #1565c0; font-size: 1.1rem; }
        .curriculum-table td { background: #f9f9f9; transition: background 0.3s; }
        .curriculum-table tr:hover td { background: #fffde7; }
    </style>
</head>
<body>
    <div class="bg-shape bg-shape1"></div>
    <div class="bg-shape bg-shape2"></div>
    <div class="bg-shape bg-shape3"></div>
    <div class="star star1"></div>
    <div class="star star2"></div>
    <div class="star star3"></div>
    <div class="student-card">
        <h3 class="mb-4 text-center" style="color:#1769aa; font-weight:700;">بطاقة تقدم الطالب</h3>
        <table class="table curriculum-table" id="curriculum-table">
            <thead>
                <tr>
                    <th>المقرر</th>
                    <th>المستوى</th>
                </tr>
            </thead>
            <tbody id="dynamic-curriculum-body">
                <tr><td colspan="2" class="text-center">جاري التحميل...</td></tr>
            </tbody>
        </table>
    </div>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
    // Proficiency levels and icons (Arabic)
    const LEVELS = [
      { label: "لا شيء", class: "level-none", icon: "⛔" },
      { label: "مبتدئ", class: "level-beginner", icon: "🔰" },
      { label: "متوسط", class: "level-intermediate", icon: "⭐" },
      { label: "متقدم", class: "level-advanced", icon: "🌟" },
      { label: "متمكن", class: "level-master", icon: "🏆" }
    ];
    // Get student ID from URL
    function getStudentIdFromUrl() {
      const parts = window.location.pathname.split('/');
      return parts[parts.length-1];
    }
    function renderCurriculum(courses, grades) {
      let html = '';
      if (courses.length === 0) {
        html = `<tr><td colspan='2' class='text-center'>لا توجد مناهج لهذا الصف</td></tr>`;
      } else {
        courses.forEach(course => {
          let level = grades[course.id];
          let levelIdx = typeof level === 'number' ? level : null;
          let badge = levelIdx !== null ? LEVELS[levelIdx] : LEVELS[0];
          html += `<tr><td>${course.name}</td><td><span class='badge badge-levels ${badge.class}'>${badge.icon} ${badge.label}</span></td></tr>`;
        });
      }
      document.getElementById('dynamic-curriculum-body').innerHTML = html;
    }
    // Fetch and render data
    function loadStudentCard() {
      const studentId = getStudentIdFromUrl();
      fetch(`/student_card/${studentId}`).then(r => r.json()).then(data => {
        if (data.courses) {
          renderCurriculum(data.courses, data.grades);
        } else {
          document.getElementById('dynamic-curriculum-body').innerHTML = `<tr><td colspan='2' class='text-danger text-center'>${data.error || 'خطأ في تحميل البيانات'}</td></tr>`;
        }
      });
    }
    loadStudentCard();
    </script>
</body>
</html>
